now calling ./run_3flows.sh tc1_data_setup.sh ..
mylist=tc1_data_setup.sh
cleaning out /opt/app/sas/custom/data
creating /opt/app/sas/custom/data
creating /opt/app/sas/custom/data/error_messages
creating /opt/app/sas/custom/data/pcrf_files_prepaid
creating /opt/app/sas/custom/data/pcrf_files_postpaid
creating /opt/app/sas/custom/data/lookup_paymenttype
creating /opt/app/sas/custom/data/lookup_recurring
creating /opt/app/sas/custom/data/output_prepaid
creating /opt/app/sas/custom/data/output_postpaid
creating /opt/app/sas/custom/data/output_fonic
creating /opt/app/sas/custom/data/bad_server_events
creating /opt/app/sas/custom/data/persist_fonic_throttle_event
creating /opt/app/sas/custom/data/persist_prepaid_throttle_event
creating /opt/app/sas/custom/data/persist_postpaid_throttle_event
############################################################################
starting tc1 at Mon Apr  7 08:38:39 PDT 2014..
running test at Mon Apr  7 08:38:39 PDT 2014
TC1:
R1: the CEP Engine delivers POSTPAID throttle 100 events with various metrics.
EDRs which have a local QuotaName and TriggerType 1 to 6 are of interest.
Throttle 100 events have the QuotaStatus=6 and QuotaValue=1.
 
R20: When the data for the primary columns is partially / fully empty, 
they get redirected to the bad_events subfolder (for possible later analysis).
The other records in the EDR stream should still be processed by the CEP engine.
The primary key columns are Time, MSISDN, SGSNAddress, UEIP, Quota_Name, Quota_consumption and Quota_Next_Reset_Time
 
 
test strategy:
input various combinations of QuotaName, TriggerType, QuotaStatus and QuotaValue 
to confirm only valid combinations result in a processed postpaid throttle 100 event
 
EDR data setup:
Row1: a valid POSTPAID throttle 100 event (Quota_Name=Q_110_local_Month, TriggerType=2, Quota_Status=6, QuotaValue=1)
Row2: a not valid POSTPAID throttle 100 event (TriggerType=7 instead of 1-6)
Row3: a not valid POSTPAID throttle 100 event (Quota_Name = Q_110_roaming_Month)
Row4: a not valid POSTPAID throttle 100 event (Quota_Status=4 instead of 6)
Row5: a not valid POSTPAID throttle 100 event (QuotaValue=11 instead of 1)
Row6: a not valid POSTPAID throttle 100 event (as its PREPAID)
 

TC1: 1. PCRF EDRs (input stream)..
TC1: 2. postpaid lkp..
TC1: 3. recurring lkp..
  adding: tc1_input_data_recurring_lkp.txt (deflated 66%)
debug ls -rtl /opt/app/sas/custom/data/lookup_recurring/
total 8
-rw-rw-r--. 1 sal sal 156 Apr  7 08:38 tc1_input_data_recurring_lkp.txt
-rw-rw-r--. 1 sal sal 267 Apr  7 08:38 tc1_input_data_recurring_lkp.txt.zip
-rw-rw-r--. 1 sal sal   0 Apr  7 08:38 tc1_input_data_recurring_lkp.txt.zip.done
TC1: 4. generating the expected output..
 
here is the contents we were looking for..
I,N:2014-04-07 08:38:39,4912345678901,0,1.2.3.4,Q_110_local_Month,12,2014-04-23 08:38:39,2,,,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,6,12,,,1024,,,,,,,,,,POSTPAID,1024,Y,1230
 
here is the postpaid lookup we used..
4912345678901,POSTPAID
4912345678902,POSTPAID
4912345678903,POSTPAID
4912345678904,POSTPAID
4912345678905,POSTPAID
4912345678906,PREPAID
 
here is the recurring lookup we used..
4912345678901,Q_110_local_Month,1230,Y
4912345678902,Q_110_local_Month,1230,Y
4912345678903,Q_110_local_Month,1230,Y
4912345678904,Q_110_local_Month,1230,Y
 
here is the EDR stream we used..
2,2014-04-07 08:38:39,,,4912345678901,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_local_Month,6,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,
7,2014-04-07 08:38:39,,,4912345678902,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_local_Month,6,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,
2,2014-04-07 08:38:39,,,4912345678903,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_roaming_Month,6,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,
2,2014-04-07 08:38:39,,,4912345678904,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_local_Month,4,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,
2,2014-04-07 08:38:39,,,4912345678905,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_local_Month,4,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,11,,
2,2014-04-07 08:38:39,,,4912345678906,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,Q_110_local_Month,6,12,,,1024,2014-04-23 08:38:39,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,,
calling ./START_CEP_ENGINE.sh  
cd /home/sal/Desktop/dev/2.2-pre/bin
starting the cep server at Mon Apr  7 08:38:39 PDT 2014..
./dfesp_xml_server -pubsub 55555 -server 55556 -loglevel debug -badevents /opt/app/sas/custom/data/bad_server_events/bad_events.txt >> /home/sal/sals_tests/cep_server.log
running in the following cep server process..
sal       8445  0.7  0.7 518080 13792 pts/0    Sl+  08:38   0:00 ./dfesp_xml_server -pubsub 55555 -server 55556 -loglevel debug -badevents /opt/app/sas/custom/data/bad_server_events/bad_events.txt
calling ./START_CEP_MODEL.sh POSTPAID_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) loading the cep model at Mon Apr  7 08:38:42 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_load.xml
<response action='load' name='POSTPAID_THROTTLE_EVENT' pubsub='auto' threads='4' use-tagged-token='true' elapsed='31 ms'>
    <message>project load POSTPAID_THROTTLE_EVENT succeeded</message>
</response>

2/3) starting the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_start.xml
 
<response action='start' name='POSTPAID_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project POSTPAID_THROTTLE_EVENT started</message>
</response>

3/3) restoring an existing binaries for this cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_restore.xml
 
<response restore='/opt/app/sas/custom/data/persist_postpaid_throttle_event' elapsed='0 ms'/>

calling ./START_CEP_MODEL.sh PREPAID_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) loading the cep model at Mon Apr  7 08:38:45 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_load.xml
<response action='load' name='PREPAID_THROTTLE_EVENT' pubsub='auto' threads='4' use-tagged-token='true' elapsed='29 ms'>
    <message>project load PREPAID_THROTTLE_EVENT succeeded</message>
</response>

2/3) starting the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_start.xml
 
<response action='start' name='PREPAID_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project PREPAID_THROTTLE_EVENT started</message>
</response>

3/3) restoring an existing binaries for this cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_restore.xml
 
<response restore='/opt/app/sas/custom/data/persist_prepaid_throttle_event' elapsed='0 ms'/>

calling ./START_CEP_MODEL.sh FONIC_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) loading the cep model at Mon Apr  7 08:38:48 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_load.xml
<response action='load' name='FONIC_THROTTLE_EVENT' pubsub='auto' threads='4' use-tagged-token='true' elapsed='34 ms'>
    <message>project load FONIC_THROTTLE_EVENT succeeded</message>
</response>

2/3) starting the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_start.xml
 
<response action='start' name='FONIC_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project FONIC_THROTTLE_EVENT started</message>
</response>

3/3) restoring an existing binaries for this cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_restore.xml
 
<response restore='/opt/app/sas/custom/data/persist_fonic_throttle_event' elapsed='0 ms'/>

calling ./START_CEP_ADAPTER.sh  
cd /home/sal/sals_tests/try10
starting the cep adapter.. java -jar o2-adapters-pcrf-2.12.2.jar >> /home/sal/sals_tests/cep_adapter.log
running in the following cep adapter process..
sal       8445  1.0  1.5 1319512 29568 pts/0   Sl+  08:38   0:00 ./dfesp_xml_server -pubsub 55555 -server 55556 -loglevel debug -badevents /opt/app/sas/custom/data/bad_server_events/bad_events.txt
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
waiting for /opt/app/sas/custom/data/output_postpaid/result.csv to be created..
######################
debug2 my_waits=7, max_count=70
######################
tc1:11. now we can compare results..
here is the contents we were looking for..
I,N:2014-04-07 08:38:39,4912345678901,0,1.2.3.4,Q_110_local_Month,12,2014-04-23 08:38:39,2,,,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,6,12,,,1024,,,,,,,,,,POSTPAID,1024,Y,1230
here is what we got..
I,N:2014-04-07 08:38:39,4912345678901,0,1.2.3.4,Q_110_local_Month,12,2014-04-23 08:38:39,2,,,,,,,,,,,0,,,,,,1.2.3.4,,,,,,,6,12,,,1024,,,,,,,,,,POSTPAID,1024,Y,1230
tc1: RESULT: SUCCESS!!! (no bad files expected and none found)
calling ./STOP_CEP_ADAPTER.sh  
killing 8622..
waiting on the following processes to stop..

calling ./STOP_CEP_MODEL.sh POSTPAID_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) persisting the cep model at Mon Apr  7 08:39:35 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_persist.xml
<response path='/opt/app/sas/custom/data/persist_postpaid_throttle_event' project='POSTPAID_THROTTLE_EVENT' elapsed='4 ms'>
    <message>project 'POSTPAID_THROTTLE_EVENT' successfully saved to '/opt/app/sas/custom/data/persist_postpaid_throttle_event'</message>
</response>

2/3) stopping the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_stop.xml
 
<response action='start' name='POSTPAID_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project POSTPAID_THROTTLE_EVENT started</message>
</response>

3/3) removing the cep model from memory..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/POSTPAID_THROTTLE_EVENT_remove.xml
 
calling ./STOP_CEP_MODEL.sh PREPAID_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) persisting the cep model at Mon Apr  7 08:39:38 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_persist.xml
<response path='/opt/app/sas/custom/data/persist_prepaid_throttle_event' project='PREPAID_THROTTLE_EVENT' elapsed='4 ms'>
    <message>project 'PREPAID_THROTTLE_EVENT' successfully saved to '/opt/app/sas/custom/data/persist_prepaid_throttle_event'</message>
</response>

<response action='remove' name='POSTPAID_THROTTLE_EVENT' elapsed='1148 ms'>
    <message>project  removal succeeded</message>
</response>

2/3) stopping the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_stop.xml
 
<response action='start' name='PREPAID_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project PREPAID_THROTTLE_EVENT started</message>
</response>

3/3) removing the cep model from memory..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/PREPAID_THROTTLE_EVENT_remove.xml
 
calling ./STOP_CEP_MODEL.sh FONIC_THROTTLE_EVENT 
cd /home/sal/Desktop/dev/2.2-pre/bin
1/3) persisting the cep model at Mon Apr  7 08:39:41 PDT 2014..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_persist.xml
<response path='/opt/app/sas/custom/data/persist_fonic_throttle_event' project='FONIC_THROTTLE_EVENT' elapsed='11 ms'>
    <message>project 'FONIC_THROTTLE_EVENT' successfully saved to '/opt/app/sas/custom/data/persist_fonic_throttle_event'</message>
</response>

<response action='remove' name='PREPAID_THROTTLE_EVENT' elapsed='1151 ms'>
    <message>project  removal succeeded</message>
</response>

2/3) stopping the cep model..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_stop.xml
 
<response action='start' name='FONIC_THROTTLE_EVENT' elapsed='0 ms'>
    <message>project FONIC_THROTTLE_EVENT started</message>
</response>

3/3) removing the cep model from memory..
./dfesp_xml_client -server localhost.localdomain:55556 -file /home/sal/sals_tests/start_stop_dir/FONIC_THROTTLE_EVENT_remove.xml
 
calling ./STOP_CEP_ENGINE.sh  
killing 8445..
waiting on the following processes to stop..
8445
ending tc1 at Mon Apr  7 08:39:48 PDT 2014..
############################################################################
